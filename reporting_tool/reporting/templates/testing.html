{% extends "base.html" %}
{% block content %}
<form id="owasp_form" method="POST">
    {% csrf_token %}
    <div class="form-group" id="select2OWASP">
        <label>OWASP:</label>
        {{ form.owasp }}
    </div>
    <div class="form-group">
        <label>Affected URL:</label>
        {{ form.affected_url }}
    </div>
    <div class="form-group">
        <label>Severity:</label>
        {{ form.severity }}
    </div>
    <!-- Broken Access Control -->
    <div class="form-group dynamic_field broken_access">
        <label>unauthorized_actions:</label>
        {{ form.unauthorized_actions }}
    </div>

    <div class="form-group dynamic_field broken_access">
        <label>access_control_flaw:</label>
        {{ form.access_control_flaw }}
    </div>

    <!-- Cryptographic -->
    <div class="form-group dynamic_field cryptographic_failure">
        <label>data_exposed:</label>
        {{ form.data_exposed }}
    </div>

    <div class="form-group dynamic_field cryptographic_failure">
        <label>encryption_issue:</label>
        {{ form.encryption_issue }}
    </div>

    <!-- Injection -->
    <div class="form-group dynamic_field injection">
        <label>injection_type:</label>
        {{ form.injection_type }}
    </div>

    <div class="form-group dynamic_field injection">
        <label>injection_input:</label>
        {{ form.injection_input }}
    </div>

    <!-- Insecure Design -->
    <div class="form-group dynamic_field insecure_design">
        <label>design_flaw:</label>
        {{ form.design_flaw }}
    </div>

    <div class="form-group dynamic_field insecure_design">
        <label>affected_component:</label>
        {{ form.affected_component }}
    </div>

    <!-- Security Misconfiguration -->
    <div class="form-group dynamic_field sec_misconfig">
        <label>misconfigured_element:</label>
        {{ form.misconfigured_element }}
    </div>

    <div class="form-group dynamic_field sec_misconfig">
        <label>configuration_flaw:</label>
        {{ form.configuration_flaw }}
    </div>

    <!-- Vulnerable and Outdated Components -->
    <div class="form-group dynamic_field vuln_component">
        <label>component_name:</label>
        {{ form.component_name }}
    </div>

    <div class="form-group dynamic_field vuln_component">
        <label>component_version:</label>
        {{ form.component_version }}
    </div>

    <!--  Identification and Authentication Failures -->
    <div class="form-group dynamic_field auth_failure">
        <label>authentication_issue:</label>
        {{ form.authentication_issue }}
    </div>

    <div class="form-group dynamic_field auth_failure">
        <label>impact_of_issue:</label>
        {{ form.impact_of_issue }}
    </div>

    <!-- Software and Data Integrity Failures -->
    <div class="form-group dynamic_field integrity_failure">
        <label>integrity_issue:</label>
        {{ form.integrity_issue }}
    </div>

    <div class="form-group dynamic_field integrity_failure">
        <label>source_of_issue:</label>
        {{ form.source_of_issue }}
    </div>

    <!--  Security Logging and Monitoring Failures -->
    <div class="form-group dynamic_field log_failure">
        <label>logging_flaw:</label>
        {{ form.logging_flaw }}
    </div>

    <div class="form-group dynamic_field log_failure">
        <label>detection_issue:</label>
        {{ form.detection_issue }}
    </div>

    <!-- Server-Side Request Forgery (SSRF) -->
    <div class="form-group dynamic_field ssrf">
        <label>trigger_point:</label>
        {{ form.trigger_point }}
    </div>

    <div class="form-group dynamic_field ssrf">
        <label>ssrf_impact:</label>
        {{ form.ssrf_impact }}
    </div>

    <button type="submit" class="btn btn-primary">Submit</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const owaspSelect = document.querySelector('.select2OWASP');

        owaspSelect.addEventListener('change', function() {
            toggleFields(this.value);
        });

        document.querySelectorAll('.dynamic_field').forEach(field => {
            field.style.display = 'none';
        });

        function toggleFields(owaspValue) {
            // Hide all dynamic fields first
            document.querySelectorAll('.dynamic_field').forEach(field => {
                field.style.display = 'none';
            });

            // Determine which class to show based on OWASP value
            let classToShow = '';
            if (owaspValue === "2") {
                classToShow = 'form-group dynamic_field broken_access';
            }
            else if (owaspValue === "3") {
                classToShow = 'form-group dynamic_field cryptographic_failure';
            } 
            else if (owaspValue === "4") {
                classToShow = 'form-group dynamic_field injection';
            }
            else if (owaspValue === "5") {
                classToShow = 'form-group dynamic_field insecure_design';
            }
            else if (owaspValue === "6") {
                classToShow = 'form-group dynamic_field sec_misconfig';
            }
            else if (owaspValue === "7") {
                classToShow = 'form-group dynamic_field vuln_component';
            }
            else if (owaspValue === "8") {
                classToShow = 'form-group dynamic_field auth_failure';
            }
            else if (owaspValue === "9") {
                classToShow = 'form-group dynamic_field integrity_failure';
            }
            else if (owaspValue === "10") {
                classToShow = 'form-group dynamic_field log_failure';
            }
            else if (owaspValue === "11") {
                classToShow = 'form-group dynamic_field ssrf';
            }

            // Show fields with the determined class
            if (classToShow) {
                Array.from(document.getElementsByClassName(classToShow)).forEach(field => {
                    field.style.display = '';
                });
            }
        }

        // Initial call to ensure correct state on page load
        if (owaspSelect.value) toggleFields(owaspSelect.value);
    });

    </script>

{% endblock content %}